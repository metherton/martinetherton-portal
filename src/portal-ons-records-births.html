<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/app-layout/app-grid/app-grid-style.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="shared-styles.html">

<dom-module id="portal-ons-records-births">
    <template>
        <style include="app-grid-style">

            .closeBtn {
                position: absolute;
                top: -1em;
                right: -2.7em;
            }

            :host {
                --app-grid-columns: 3;
                --app-grid-item-height: 100px;
                /*--app-grid-expandible-item-columns: 3;*/
            }

            ul {
                padding: 0;
                list-style: none;
            }

            .item {
                /*background-color: white;*/
            }
            /* Only the first item should expand */
            .item:first-child {
                @apply --app-grid-expandible-item;
            }
            /*@media (max-width: 640px) {*/
                /*:host {*/
                    /*--app-grid-columns: 1;*/
                /*}*/
            /*}*/
            paper-card.white {
                --paper-card-header-color: #fff;
            }

            paper-dialog {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                padding: 0;
                margin: 0;
            }

            .gray {
                background-color: #a8a8a8;
            }

            .lightgray {
                background-color: #e5e5e5;
            }

        </style>

        <paper-dialog id="addPerson" entry-animation="scale-up-animation" exit-animation="fade-out-animation">
            <h2>Add Person</h2>
            <div>
                <paper-input floatingLabel="true" label="First Name" value="{{editModel.firstName}}"></paper-input>
                <paper-input floatingLabel="true" label="Surname" value="{{editModel.surname}}"></paper-input>
                <paper-input floatingLabel="true" label="Place of Birth" value="{{editModel.placeOfBirth}}"></paper-input>
                <paper-input floatingLabel="true" label="Date of Birth" value="{{editModel.dateOfBirth}}"></paper-input>
                <!--<paper-button dialog-confirm tabindex="0" raised colored on-click="saveProfile">Save</paper-button>-->
                <!--<paper-button dialog-dismiss tabindex="0" raised colored on-click="closePanel">Cancel</paper-button>-->
            </div>
            <div class="buttons">
                <paper-button dialog-confirm tabindex="0" raised colored on-click="savePerson">Save</paper-button>
                <paper-button dialog-dismiss tabindex="0" raised colored on-click="closePanel">Cancel</paper-button>
                <!--<paper-button dialog-dismiss>Cancel</paper-button>-->
                <!--<paper-button dialog-confirm autofocus>Accept</paper-button>-->
            </div>
        </paper-dialog>

        <!--<div class$="{{panelToggle}}">-->
            <!--<div class="edit-panel shadow-right">-->
                <!--<paper-input floatingLabel="true" label="First Name" value="{{editModel.firstName}}"></paper-input>-->
                <!--<paper-input floatingLabel="true" label="Surname" value="{{editModel.surname}}"></paper-input>-->
                <!--<paper-input floatingLabel="true" label="Place of Birth" value="{{editModel.placeOfBirth}}"></paper-input>-->
                <!--<paper-input floatingLabel="true" label="Date of Birth" value="{{editModel.dateOfBirth}}"></paper-input>-->
                <!--<paper-button tabindex="0" raised colored on-click="savePerson">Save</paper-button>-->
                <!--<paper-button tabindex="0" raised colored on-click="closePanel">Cancel</paper-button>-->
            <!--</div>-->
        <!--</div>-->

        <paper-icon-button icon="add" on-tap="openPanel"></paper-icon-button>

        <ul class="app-grid">
            <template is="dom-repeat" items="[[ajaxResponse]]" indexAs="index">
                <!--<li class="item"><div class="horizontal"><paper-card heading="[[item.firstName]] [[item.surname]]"><div class="card-content">Born in [[item.placeOfBirth]] on [[item.dateOfBirth]]</div></paper-card></div></li>-->
                <li class$="{{productClass(index)}}">[[item.firstName]] [[item.surname]]</li><li class$="{{productClass(index)}}">[[item.placeOfBirth]]</li><li class$="{{productClass(index)}}">[[item.dateOfBirth]]</li>
            </template>
        </ul>

        <paper-toast id="toast"></paper-toast>

        <iron-ajax auto id="getPersons"
                    url="http://www.martinetherton.com:5001/users"
                    handle-as="json"
                    last-response="{{ajaxResponse}}" debounce-duration="300">

        </iron-ajax>
        <iron-ajax id="savePerson"
                   url="http://www.martinetherton.com:5001/users"
                   handle-as="json" method="POST" on-response="savePersonCallback" debounce-duration="300">

        </iron-ajax>
        <!--<pre>[[json(ajaxResponse)]]</pre>-->

    </template>

    <script>
        class PortalOnsRecordsBirths extends Polymer.Element {
            static get is() {
                return 'portal-ons-records-births';
            }

            static get properties() {
                return {
                    prop1: {
                        type: String,
                        value: "bar"
                    },
                    editModel: {
                        type: Object,
                        notify: true
                    },
                    panelToggle: {
                        type: String,
                        value: "",
                        notify: true
                    }

                }
            }

            json(obj) {
                return JSON.stringify(obj, null, 2);
            }

            openPanel(e) {
                var self = this;
                this.$.addPerson.opened = true;
                self.panelToggle = "toggled";
                self.editModel = {firstName: "", surname: "", dateOfBirth:"", placeOfBirth:""}
            }

            closePanel() {
                this.panelToggle = "";
            }

            savePerson() {
                var self = this;
                self.$.savePerson.body = JSON.stringify(self.editModel);
                self.$.savePerson.contentType = "application/json";
                self.$.savePerson.generateRequest();
            }

            savePersonCallback() {
                var self = this;
                self.$.toast.text = "Birth saved";
                self.$.toast.show();
                self.closePanel();
                self.$.getPersons.generateRequest();
            }

            productClass(index) {
                let color = index % 2 == 0 ? 'white' : 'lightgray';
                return 'item ' + color;
            }





        }

        window.customElements.define(PortalOnsRecordsBirths.is, PortalOnsRecordsBirths);

    </script>
</dom-module>
