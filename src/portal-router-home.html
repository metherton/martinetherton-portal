<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<script src="../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
<link rel="import" href="../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="good-map.html">
<link rel="import" href="shared-styles.html">

<dom-module id="portal-router-home">
    <template>
        <style include="shared-styles">
            :host {
                display: block;

                /*padding: 10px;*/
            }
            p.home-title {
                margin-left: 24px;
                font-size: 1.25rem;
            }

            paper-card {
                /*--paper-card-header-color: white;*/
                margin-left: 5px;
            }


            paper-card:hover {
                cursor: pointer;
            }

            good-map {
                display: block;
                height: 600px;
                margin-left: 5px;
                margin-right: 5px;
            }

        </style>

        <paper-dialog id="addRoute" entry-animation="scale-up-animation" exit-animation="fade-out-animation">
            <h2>Add Route</h2>
            <div>
                <paper-dropdown-menu class="custom" label="Start Port">
                    <paper-listbox id="start" attr-for-selected="value" slot="dropdown-content" class="dropdown-content" selected="1">
                        <template is="dom-repeat" items="[[ajaxResponseCities]]" indexAs="index">
                            <paper-item value="[[item.longitude]]_[[item.latitude]]">[[item.name]]</paper-item>
                        </template>
                    </paper-listbox>
                </paper-dropdown-menu>
            </div>
            <div>
                <paper-dropdown-menu class="custom"  label="Destination Port">
                    <paper-listbox id="end" slot="dropdown-content" class="dropdown-content" attr-for-selected="value" selected="1">
                        <template is="dom-repeat" items="[[ajaxResponseCities]]" indexAs="index">
                            <paper-item value="[[item.longitude]]_[[item.latitude]]">[[item.name]]</paper-item>
                        </template>
                    </paper-listbox>
                </paper-dropdown-menu>
            </div>
            <div class="buttons">
                <paper-button dialog-confirm tabindex="0" raised colored on-click="getWaypoints">Save</paper-button>
                <paper-button dialog-dismiss tabindex="0" raised colored on-click="closePanel">Cancel</paper-button>
            </div>
        </paper-dialog>

        <paper-icon-button icon="add" on-tap="openPanel"></paper-icon-button>

        <paper-toast id="toast"></paper-toast>

        <iron-ajax auto id="getWaypoints"
                   handle-as="json"
                   last-response="{{ajaxResponseWaypoints}}" debounce-duration="300">

        </iron-ajax>

        <iron-ajax auto id="getCities"
                   handle-as="json"
                   url="/resources/cities.json"
                   last-response="{{ajaxResponseCities}}" debounce-duration="300">

        </iron-ajax>

        <good-map api-key="AIzaSyA-XiHqcr56619BrW1PZYzaTFnXVaMT6PY"
                  latitude="30"
                  longitude="-100" zoom="2"
                  map-options='{"mapTypeId": "satellite"}'>
        </good-map>

    </template>

    <script>
        class PortalRouterHome extends Polymer.Element {
            static get is() {
                return 'portal-router-home';
            }
            static get properties() {
                return {
                    prop1: {
                        type: String,
                        value: "bar"
                    },
                    editModel: {
                        type: Object,
                        notify: true
                    },
                    panelToggle: {
                        type: String,
                        value: "",
                        notify: true
                    }

                }
            }

            ready() {
                super.ready();
                this.$.getCities.generateRequest();
            }

            json(obj) {
                return JSON.stringify(obj, null, 2);
            }

            openPanel(e) {
                var self = this;
                this.$.addRoute.opened = true;
                self.panelToggle = "toggled";
                self.editModel = {start: "", destination: ""}
            }

            closePanel() {
                this.panelToggle = "";
            }

            getWaypoints() {
                var self = this;
                self.$.getWaypoints.url = "http://www.martinetherton.com:8080/routeAdvices/" + this.$.addRoute.querySelector('#start').selected + "/" + this.$.addRoute.querySelector('#end').selected;
                self.$.getWaypoints.generateRequest();
            }
        }

        window.customElements.define(PortalRouterHome.is, PortalRouterHome);
    </script>
</dom-module>
